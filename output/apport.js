/*!Apport.js v. 1.1.0 - https://github.com/jesperhoy/apport.js - Copyright 2024 Jesper Hoy*/
(()=>{async function u(e){function i(t,s){throw document.dispatchEvent(new CustomEvent("ap-error",{detail:{error:s,...t}})),s}let r={...e};e.method||(e.method="GET"),e.url||(e.url=window.location.href);let n;if(e.method=="POST"||e.method=="PUT"){if(e.form&&e.form!=="none"){if(typeof e.form=="string"&&(e.form=document.querySelector(e.form)),e.validate&&!e.form.reportValidity())return;n=new FormData(e.form)}else n=new FormData;let t=!1;for(let s of n)if(s[1]instanceof File){t=!0;break}t||(n=new URLSearchParams(n))}document.dispatchEvent(new CustomEvent("ap-begin",{detail:r}));let a={method:e.method,headers:{"AP-Request":"true"},redirect:"error"};e.data!==void 0&&(a.headers["AP-Data"]=encodeURI(JSON.stringify(e.data))),e.trigger&&(a.headers["AP-Trigger"]=encodeURI(e.trigger)),e.triggerName&&(a.headers["AP-Trigger-Name"]=encodeURI(e.triggerName)),(e.method=="POST"||e.method=="PUT")&&(a.body=n);let o;try{o=await fetch(e.url,a)}catch(t){i(r,t)}let d;if(d=o.headers.get("AP-redirect")){location.href=d;return}if(o.headers.get("AP-reload")==="true"){location.reload();return}if(o.status>=200&&o.status<=202){(d=o.headers.get("AP-swap"))&&(e.swap=d),r.swap=e.swap;let t;e.swap!="none"&&((d=o.headers.get("AP-target"))&&(e.target=d),e.target||i(r,new Error("Missing target")),r.target=e.target,typeof e.target=="string"?(t=document.querySelector(e.target),t||i(r,new Error("Element of AP-Target header not found: "+e.target))):t=e.target);let s;if(e.swap!="none"&&e.swap!="delete"){let m=document.createElement("template");m.innerHTML=await o.text(),s=m.content;let h=s.querySelectorAll("script");for(let l of h){let p=document.createElement("script");for(let c of l.attributes)p.setAttribute(c.name,c.value);p.innerHTML=l.innerHTML,l.parentNode.replaceChild(p,l)}}switch(e.swap??"inner"){case"inner":t.innerHTML="",t.appendChild(s);break;case"first":t.firstChild?t.insertBefore(s,t.firstChild):t.appendChild(s);break;case"last":t.appendChild(s);break;case"replace":t.parentNode.replaceChild(s,t);break;case"before":t.parentNode.insertBefore(s,t);break;case"after":t.nextSibling?t.parentNode.insertBefore(s,t.nextSibling):t.parentNode.appendChild(s);break;case"delete":t.remove();break;case"none":break;default:i(r,new Error("Invalid swap value: "+e.swap))}}else o.status===204||i(r,new Error("Unsupported response status code received: "+o.status));(d=o.headers.get("AP-push-url"))&&window.history.pushState(null,"",d),(d=o.headers.get("AP-replace-url"))&&window.history.replaceState(null,"",d),(d=o.headers.get("AP-execute"))&&new Function("$opt",decodeURIComponent(d))(r),document.dispatchEvent(new CustomEvent("ap-done",{detail:r}))}function w(e,i){function r(){let a={};a.method=i.toUpperCase();let o=e.getAttribute("ap-"+i);o&&(a.url=o),a.swap=e.getAttribute("ap-swap")??void 0,e.hasAttribute("ap-validate")?a.validate=e.getAttribute("ap-validate")!=="false":a.validate=e.tagName.toLowerCase()==="form",a.target=e.getAttribute("ap-target")??e;var d=e.getAttribute("ap-data");if(d){let t=new Function("return "+d);try{a.data=t.call(e)}catch(s){throw new Error('Error evaluating ap-data attribute value ("'+d+'") on '+e.tagName+" element "+(e.id?"#"+e.id:""),{cause:s})}}return a.trigger=e.id??void 0,a.triggerName=e.getAttribute("name")??void 0,(i=="post"||i=="put")&&(a.form=e.closest("form")??void 0),a}let n=null;if(e.hasAttribute("ap-on"))n=e.getAttribute("ap-on");else{let a=e.tagName.toLowerCase();n=["input","textarea","select"].indexOf(a)>=0?"change":a==="form"?"submit":"click"}n==="mount"?u(r()):e.addEventListener(n,a=>{a.preventDefault(),u(r())})}function E(e){let i=e.hasAttribute("ap-trim"),r=e.hasAttribute("ap-validity");if(!i&&!r)return;i&&(e.value=e.value.trim());let n;r&&(n=new Function("return "+e.getAttribute("ap-validity")),e.setCustomValidity(n.call(e))),e.addEventListener("change",a=>{i&&(e.value=e.value.trim()),r&&e.setCustomValidity(n.call(e))})}var g=new Set;function f(){let e=document.querySelectorAll("[ap-get],[ap-post],[ap-put],[ap-delete],[ap-trim],[ap-validity]"),i=new Set;for(let r of e)if(i.add(r),!g.has(r)){E(r);for(let n of["get","post","put","delete"])r.hasAttribute("ap-"+n)&&w(r,n)}g=i}var v=new MutationObserver(f);document.addEventListener("DOMContentLoaded",()=>{f(),v.observe(document,{subtree:!0,childList:!0})});globalThis.Apport=u;})();
//# sourceMappingURL=apport.js.map
