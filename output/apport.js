/*!Apport.js v. 1.0.2 - https://github.com/jesperhoy/apport.js - Copyright 2024 Jesper Hoy*/
(()=>{async function u(e){function d(t,n){throw document.dispatchEvent(new CustomEvent("ap-error",{detail:{error:n,...t}})),n}let a={...e};e.method||(e.method="GET"),e.url||(e.url=window.location.href);let o;if(e.method=="POST"||e.method=="PUT"){if(e.form&&e.form!=="none"){if(typeof e.form=="string"&&(e.form=document.querySelector(e.form)),e.validate&&!e.form.reportValidity())return;o=new FormData(e.form)}else o=new FormData;let t=!1;for(let n of o)if(n[1]instanceof File){t=!0;break}t||(o=new URLSearchParams(o))}document.dispatchEvent(new CustomEvent("ap-begin",{detail:a}));let r={method:e.method,headers:{"AP-Request":"true"},redirect:"error"};e.data!==void 0&&(r.headers["AP-Data"]=encodeURI(JSON.stringify(e.data))),e.trigger&&(r.headers["AP-Trigger"]=encodeURI(e.trigger)),e.triggerName&&(r.headers["AP-Trigger-Name"]=encodeURI(e.triggerName)),(e.method=="POST"||e.method=="PUT")&&(r.body=o);let i;try{i=await fetch(e.url,r)}catch(t){d(a,t)}let s;if(s=i.headers.get("AP-redirect")){location.href=s;return}if(i.headers.get("AP-reload")==="true"){location.reload();return}if(i.status>=200&&i.status<=202){(s=i.headers.get("AP-swap"))&&(e.swap=s),a.swap=e.swap;let t;e.swap!="none"&&((s=i.headers.get("AP-target"))&&(e.target=s),e.target||d(a,new Error("Missing target")),a.target=e.target,typeof e.target=="string"?(t=document.querySelector(e.target),t||d(a,new Error("Element of AP-Target header not found: "+e.target))):t=e.target);let n;if(e.swap!="none"&&e.swap!="delete"){let c=document.createElement("template");c.innerHTML=await i.text(),n=c.content;let h=n.querySelectorAll("script");for(let l of h){let p=document.createElement("script");for(let m of l.attributes)p.setAttribute(m.name,m.value);p.innerHTML=l.innerHTML,l.parentNode.replaceChild(p,l)}}switch(e.swap??"inner"){case"inner":t.innerHTML="",t.appendChild(n);break;case"first":t.firstChild?t.insertBefore(n,t.firstChild):t.appendChild(n);break;case"last":t.appendChild(n);break;case"replace":t.parentNode.replaceChild(n,t);break;case"before":t.parentNode.insertBefore(n,t);break;case"after":t.nextSibling?t.parentNode.insertBefore(n,t.nextSibling):t.parentNode.appendChild(n);break;case"delete":t.remove();break;case"none":break;default:d(a,new Error("Invalid swap value: "+e.swap))}}else i.status===204||d(a,new Error("Unsupported response status code received: "+i.status));(s=i.headers.get("AP-push-url"))&&window.history.pushState(null,"",s),(s=i.headers.get("AP-replace-url"))&&window.history.replaceState(null,"",s),(s=i.headers.get("AP-execute"))&&new Function("$opt",decodeURIComponent(s))(a),document.dispatchEvent(new CustomEvent("ap-done",{detail:a}))}function w(e,d){function a(){let r={};r.method=d.toUpperCase();let i=e.getAttribute("ap-"+d);i&&(r.url=i),r.swap=e.getAttribute("ap-swap")??void 0,e.hasAttribute("ap-validate")?r.validate=e.getAttribute("ap-validate")!=="false":r.validate=e.tagName.toLowerCase()==="form",r.target=e.getAttribute("ap-target")??e;var s=e.getAttribute("ap-data");if(s){let t=new Function("return "+s);try{r.data=t()}catch(n){throw new Error('Error evaluating ap-data attribute value ("'+s+'") on '+e.tagName+" element "+(e.id?"#"+e.id:""),{cause:n})}}return r.trigger=e.id??void 0,r.triggerName=e.getAttribute("name")??void 0,(d=="post"||d=="put")&&(r.form=e.closest("form")??void 0),r}let o=null;if(e.hasAttribute("ap-on"))o=e.getAttribute("ap-on");else{let r=e.tagName.toLowerCase();o=["input","textarea","select"].indexOf(r)>=0?"change":r==="form"?"submit":"click"}o==="mount"?u(a()):e.addEventListener(o,r=>{r.preventDefault(),u(a())})}var g=new Set;function f(){let e=document.querySelectorAll("[ap-get],[ap-post],[ap-put],[ap-delete]"),d=new Set;for(let a of e)if(d.add(a),!g.has(a))for(let o of["get","post","put","delete"])a.hasAttribute("ap-"+o)&&w(a,o);g=d}var E=new MutationObserver(f);document.addEventListener("DOMContentLoaded",()=>{f(),E.observe(document,{subtree:!0,childList:!0})});globalThis.Apport=u;})();
//# sourceMappingURL=apport.js.map
