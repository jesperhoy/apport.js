/*!Apport.js v. 1.1.1 - https://github.com/jesperhoy/apport.js - Copyright 2024 Jesper Hoy*/
(()=>{async function u(e){function a(t,i){throw document.dispatchEvent(new CustomEvent("ap-error",{detail:{error:i,...t}})),i}let n={...e};e.method||(e.method="GET"),e.url||(e.url=window.location.href);let l;if(e.method=="POST"||e.method=="PUT"){if(e.form&&e.form!=="none"){if(typeof e.form=="string"&&(e.form=document.querySelector(e.form)),e.validate&&!e.form.reportValidity())return;l=new FormData(e.form)}else l=new FormData;let t=!1;for(let i of l)if(i[1]instanceof File){t=!0;break}t||(l=new URLSearchParams(l))}document.dispatchEvent(new CustomEvent("ap-begin",{detail:n}));let r={method:e.method,headers:{"AP-Request":"true"},redirect:"error"};e.data!==void 0&&(r.headers["AP-Data"]=encodeURI(JSON.stringify(e.data))),e.trigger&&(r.headers["AP-Trigger"]=encodeURI(e.trigger)),e.triggerName&&(r.headers["AP-Trigger-Name"]=encodeURI(e.triggerName)),(e.method=="POST"||e.method=="PUT")&&(r.body=l);let s;try{s=await fetch(e.url,r)}catch(t){a(n,t)}let o;if(o=s.headers.get("AP-redirect")){location.href=o;return}if(s.headers.get("AP-reload")==="true"){location.reload();return}if(s.status>=200&&s.status<=202){(o=s.headers.get("AP-swap"))&&(e.swap=o),n.swap=e.swap;let t;e.swap!="none"&&((o=s.headers.get("AP-target"))&&(e.target=o),e.target||a(n,new Error("Missing target")),n.target=e.target,typeof e.target=="string"?(t=document.querySelector(e.target),t||a(n,new Error("Element of AP-Target header not found: "+e.target))):t=e.target);let i;if(e.swap!="none"&&e.swap!="delete"){let c=document.createElement("template");c.innerHTML=await s.text(),i=c.content;let w=i.querySelectorAll("script");for(let d of w){let p=document.createElement("script");for(let m of d.attributes)p.setAttribute(m.name,m.value);p.innerHTML=d.innerHTML,d.parentNode.replaceChild(p,d)}}switch(e.swap??"inner"){case"inner":t.innerHTML="",t.appendChild(i);break;case"first":t.firstChild?t.insertBefore(i,t.firstChild):t.appendChild(i);break;case"last":t.appendChild(i);break;case"replace":t.parentNode.replaceChild(i,t);break;case"before":t.parentNode.insertBefore(i,t);break;case"after":t.nextSibling?t.parentNode.insertBefore(i,t.nextSibling):t.parentNode.appendChild(i);break;case"delete":t.remove();break;case"none":break;default:a(n,new Error("Invalid swap value: "+e.swap))}}else s.status===204||a(n,new Error("Unsupported response status code received: "+s.status));(o=s.headers.get("AP-push-url"))&&window.history.pushState(null,"",o),(o=s.headers.get("AP-replace-url"))&&window.history.replaceState(null,"",o),(o=s.headers.get("AP-execute"))&&new Function("$opt",decodeURIComponent(o))(n),document.dispatchEvent(new CustomEvent("ap-done",{detail:n}))}function E(e,a){function n(){let r={};r.method=a.toUpperCase();let s=e.getAttribute("ap-"+a);s&&(r.url=s),r.swap=e.getAttribute("ap-swap")??void 0,e.hasAttribute("ap-validate")?r.validate=e.getAttribute("ap-validate")!=="false":r.validate=e.tagName.toLowerCase()==="form",r.target=e.getAttribute("ap-target")??e;var o=e.getAttribute("ap-data");if(o){let t=new Function("return "+o);try{r.data=t.call(e)}catch(i){throw new Error('Error evaluating ap-data attribute value ("'+o+'") on '+e.tagName+" element "+(e.id?"#"+e.id:""),{cause:i})}}return r.trigger=e.id??void 0,r.triggerName=e.getAttribute("name")??void 0,(a=="post"||a=="put")&&(r.form=e.closest("form")??void 0),r}let l=null;if(e.hasAttribute("ap-on"))l=e.getAttribute("ap-on");else{let r=e.tagName.toLowerCase();l=["input","textarea","select"].indexOf(r)>=0?"change":r==="form"?"submit":"click"}l==="mount"?u(n()):e.addEventListener(l,r=>{r.preventDefault(),u(n())})}function v(e){let a=e.hasAttribute("ap-trim"),n=e.hasAttribute("ap-validity"),l=n?new Function("return "+e.getAttribute("ap-validity")):null;function r(){a&&(e.value=e.value.trim()),n&&e.setCustomValidity(l.call(e))}r(),e.addEventListener("change",r)}var g=new Set,f=new Set;function h(){let e=new Set(document.querySelectorAll("[ap-get],[ap-post],[ap-put],[ap-delete]"));for(let a of e)if(!g.has(a))for(let n of["get","post","put","delete"])a.hasAttribute("ap-"+n)&&E(a,n);g=e,e=new Set(document.querySelectorAll("[ap-trim],[ap-validity]"));for(let a of e)f.has(a)||v(a);f=e}var b=new MutationObserver(h);document.addEventListener("DOMContentLoaded",()=>{h(),b.observe(document,{subtree:!0,childList:!0})});globalThis.Apport=u;})();
//# sourceMappingURL=apport.js.map
